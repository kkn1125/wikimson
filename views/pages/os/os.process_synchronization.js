export default {
    published: true,
    title: 'Process Synchronization',
    modified: '2022-03-02 21:36:58',
    done: true,
    tags: ['os', 'process', 'pid', 'synchronization'],
    categories: ['cs','Operating System'],
    authors: ['kimson'],
    wrote: '2022-02-27 22:27:39',
    toc: true,
    md: true,
    content: [`
# Thread

## ì“°ë ˆë“œ (Thread)

> í”„ë¡œê·¸ë¨ ë‚´ë¶€ì˜ íë¦„, ë§¥ì´ë‹¤.

\`\`\`java
class Test {
    public static void main(String[] args) {
        int n = 0;
        int m = 6;
        System.out.pringln(n * m);
        while(n < m)
        n++;
        System.out.pringln("Bye");
    }
}
\`\`\`

ìœ„ì˜ ì½”ë“œê°€ í”„ë¡œê·¸ë¨ì˜ íë¦„ì´ë‹¤. ì´ëŸ¬í•œ ë§¥ì„ ì“°ë ˆë“œë¼ í•œë‹¤.

### ë‹¤ì¤‘ ì“°ë ˆë“œ(Multithreads)

í•œ í”„ë¡œê·¸ë¨ì— 2ê°œ ì´ìƒì˜ ë§¥ì´ ìˆë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤. ë§¥(íë¦„)ì´ ë¹ ë¥¸ ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ìŠ¤ìœ„ì¹­ë˜ê¸° ë•Œë¬¸ì— ì—¬ëŸ¬ ë§¥ì´ ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì¸ë‹¤. \`ë™ì‹œ(concurrent){:.bg-danger}\` vs \`ì§„ì§œë¡œ ë™ì‹œì—(simultaneous)\`. ì‹¤ì œë¡œëŠ” CPUê°€ í•˜ë‚˜ì´ê¸° ë•Œë¬¸ì— concurrentí•œ ê²ƒì´ ë§ë‹¤.

- ì›¹ ==> í™”ë©´ì„ ì¶œë ¥í•˜ëŠ” ìŠ¤ë ˆë“œì™€ ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ” ìŠ¤ë ˆë“œ
- ì›Œë“œ í”„ë¡œì„¸ì„œ ==> í™”ë©´ ì¶œë ¥ ìŠ¤ë ˆë“œ + í‚¤ë³´ë“œ ì…ë ¥ ìŠ¤ë ˆë“œ + ì² ì/ë¬¸ë²• ì˜¤ë¥˜ í™•ì¸ ìŠ¤ë ˆë“œ

í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ì—ëŠ” ê¸°ë³¸ 1ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ê°€ì§„ë‹¤. ì´ë¥¼ *ë‹¨ì¼ ìŠ¤ë ˆë“œ(Single Thread) í”„ë¡œê·¸ë¨*ì´ë¼ í•œë‹¤. í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ì— ì—¬ëŸ¬ ê°œì˜ ìŠ¤ë ˆë“œê°€ ìˆìœ¼ë©´ *ë‹¤ì¤‘ ìŠ¤ë ˆë“œ(Multi-thread) í”„ë¡œê·¸ë¨*ì´ë¼ í•œë‹¤.

### ìŠ¤ë ˆë“œì˜ êµ¬ì¡°

\`P@1@\` \`P@2@\` \`P@3@\` 3ê°œì˜ í”„ë¡œì„¸ìŠ¤ê°€ ìˆë‹¤ê³  ê°€ì •í•  ë•Œ, P@1@ì´ ì‹¤í–‰ë˜ë©´ ë³´í†µì€ í•œ ê°œê°€ ëŒì§€ë§Œ í•œ ê°œ ì´ìƒì˜ ìŠ¤ë ˆë“œê°€ ëŒ ìˆ˜ ìˆë‹¤. P@1@ì´ í”„ë¦°í„°ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´ ìŠ¤ë ˆë“œë“¤ì€ í”„ë¦°í„°ë‚˜ í•´ë‹¹ íŒŒì¼ì„ ê³µìœ í•˜ë©° ì‚¬ìš©í•˜ê²Œ ëœë‹¤.

ìŠ¤íƒì€ ì£¼ë¡œ ë¦¬í„´ ê°’ì´ë‚˜ íŒŒë¼ë¯¸í„°ë¥¼ ì €ì¥í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ”ë°, ìŠ¤ë ˆë“œê°€ ì„œë¡œ ë‹¤ë¥¸ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì— ìŠ¤íƒì— ì €ì¥ë˜ëŠ” ë‚´ìš©ë„ ë‹¤ë¥´ë‹¤.

ë³´í†µ í•˜ë‚˜ì˜ í”„ë¡œê·¸ë¨ì´ ì½”ë“œ, ìŠ¤íƒ, ë°ì´í„°ë¡œ êµ¬ì„±ëœë‹¤. ì½”ë“œì™€ ë°ì´í„°ë¥¼ ì„œë¡œ ê³µìœ í•˜ì§€ë§Œ, ìŠ¤íƒì€ ê³µìœ í•˜ì§€ ì•Šê³  ë”°ë¡œ ê°€ì§„ë‹¤. í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œê°€ í˜¸ì¶œë˜ì–´ ì‹¤í–‰ë í…ë° ì´ë•Œ íŒŒë¼ë¯¸í„°ë‚˜ ë¦¬í„´ ì–´ë“œë ˆìŠ¤ ë“±ì€ ìŠ¤ìœ„ì¹­ ë•Œ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì— ê°€ì•¼í•˜ê¸° ë•Œë¬¸ì— ê³µìœ í•˜ë©´ ì•ˆ ëœë‹¤.

- í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ ê³µê°„ ê³µìœ  (code, data)
- í”„ë¡œì„¸ìŠ¤ì˜ ìì› ê³µìœ (file, I/O)
- ë¹„ê³µìœ  ==> ê°œë³„ì ì¸ PC, SP, registers, stack

### í”„ë¡œì„¸ìŠ¤ ìŠ¤ìœ„ì¹­ vs ìŠ¤ë ˆë“œ ìŠ¤ìœ„ì¹­

ì•ì—ì„œ ì‹±ê¸€ ìŠ¤ë ˆë“œê¹Œì§€ëŠ” ì‰½ê²Œ í•˜ê¸° ìœ„í•´ í”„ë¡œì„¸ìŠ¤ ë‹¨ìœ„ë¡œ ìŠ¤ìœ„ì¹­í•œë‹¤ê³  ìƒê°í–ˆì§€ë§Œ, ì‹¤ì œë¡œëŠ” ìŠ¤ë ˆë“œ ë‹¨ìœ„ì˜ ìŠ¤ìœ„ì¹­ì´ ì¼ì–´ë‚œë‹¤. ì˜›ë‚ ì—ëŠ” í”„ë¡œì„¸ìŠ¤ë§Œ ìŠ¤ìœ„ì¹­ ë˜ëŠ” í˜•ì‹ì´ì—ˆì§€ë§Œ í˜„ëŒ€ì˜ ìš´ì˜ì²´ì œëŠ” ìŠ¤ë ˆë“œë„ ê°™ì´ ìŠ¤ìœ„ì¹­ë˜ê¸° ë•Œë¬¸ì— *ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ ë‹¨ìœ„*ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ì•„ë‹Œ *ìŠ¤ë ˆë“œ*ì´ë‹¤.

### ë§¥ ë§Œë“¤ê¸° (ğŸ âŒ) feat.JAVA

> java.lang ==> Thread
> ì£¼ìš” ë©”ì„œë“œ
    - public void run() ==> ìƒˆë¡œìš´ ë§¥ì´ íë¥´ëŠ” ê³³ (ì¹˜í™˜)
    - void start() ==> ìŠ¤ë ˆë“œ ì‹œì‘ ìš”ì²­
    - void join() ==> ìŠ¤ë ˆë“œ ë§ˆì¹˜ê¸° ê¸°ë‹¤ë¦¼
    - static void sleep() ==> ìŠ¤ë ˆë“œ ì ìê¸°

\`thread.run()\`í•˜ë©´ ìŠ¤ë ˆë“œê°€ ì‹œì‘ë˜ë©´ \`run()\` ë©”ì†Œë“œê°€ ì‹¤í–‰ëœë‹¤. ê·¸ë¦¬ê³  \`run()\`ë©”ì†Œë“œë¥¼ ì¹˜í™˜í•œë‹¤.

#### ì˜ˆì œ

> ê¸€ì Aì™€ Bë¥¼ ë™ì‹œì— í™”ë©´ì— ì¶œë ¥í•˜ê¸°
    - ëª¨ë“  í”„ë¡œê·¸ë¨ì€ ì²˜ìŒë¶€í„° 1ê°œì˜ ìŠ¤ë ˆë“œëŠ” ê°–ê³  ìˆë‹¤. (main)
    - 2ê°œì˜ ìŠ¤ë ˆë“œ ==> main + MyTread

\`\`\`java
public class Test {
    public static void main(String[] args) {
        MyThread th = new MyThread();
        th.run();
        while (true) {
            System.out.println("A");
            try{
                Thread.sleep(100);
            } catch(InterruptedException e) {}
        }
    }
}
class MyThread extends Thread {
    pubic void run(){
        while (true) System.out.println("B");
        try{
            Thread.sleep(100);
        } catch(InterruptedException e) {}
    }
}
\`\`\`

## í”„ë¡œì„¸ìŠ¤ ë™ê¸°í™” (Process Synchronization) {:.text-danget}

ì œëª©ì€ processì´ì§€ë§Œ í˜„ëŒ€ì—ëŠ” *thread*ì´ë‹¤. ì¦‰, *thread synchronization*ìœ¼ë¡œ ìƒê°í•˜ë©´ ëœë‹¤.

- Concurrent access to shared data may result in data inconsistency
    - ê³µìœ ëœ ë°ì´í„°(ë°ì´í„°ë² ì´ìŠ¤ë“ , í”„ë¦°í„°ë“ )ì— ë™ì‹œì— ì ‘ê·¼í•˜ë©´ ë°ì´í„° ë¶ˆì¼ì¹˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
- Oderly execution of cooperating processes so that data consistency is maintained.
    - ë°ì´í„° ì¼ê´€ì„±ì´ ìœ ì§€ë˜ë„ë¡ í˜‘ë ¥ í”„ë¡œì„¸ìŠ¤ë¥¼ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰í•œë‹¤.

### Independentì™€ Cooperation

- \`Independent(ë…ë¦½)\` ==> \`P@1@\` \`P@2@\`ê°€ ëŒê³  ìˆì„ ë•Œ ë‘˜ ì‚¬ì´ì˜ ì•„ë¬´ëŸ° ê´€ê³„ê°€ ì—†ìœ¼ë©´ Independent process(ë…ë¦½ í”„ë¡œì„¸ìŠ¤)ë¼ í•œë‹¤.
- \`Cooperation(í˜‘ì¡°, í˜‘ë ¥)\` ==> ì‹œìŠ¤í…œ ë‚´ì—ì„œ ì‹¤í–‰ë˜ëŠ” ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì—ê²Œ ì˜í–¥ì„ ë¯¸ì¹˜ê±°ë‚˜ í˜¹ì€ ë°›ê±°ë‚˜ í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ *Cooperating Process*ë¼ í•œë‹¤.

- í”„ë¡œì„¸ìŠ¤ê°„ í†µì‹  ==> ì´ ë‘˜ ì¤‘, \`Cooperating\` í”„ë¡œê·¸ë¨ì´ ë§ë‹¤. ë©”ì¼ì˜ ê²½ìš° ë°›ëŠ” í”„ë¡œì„¸ìŠ¤, ì£¼ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ìˆì„í…ë°, ë©”ì„¸ì§€ë¥¼ ê³µìœ í•˜ë©´ì„œ ì„œë¡œ ì˜í–¥ì„ ì£¼ê³  ë°›ëŠ”ë‹¤.
- í”„ë¡œì„¸ìŠ¤ê°„ ìì› ê³µìœ  ==> *ëª…ì ˆ ê¸°ì°¨ í‘œ*ë¥¼ ì˜ˆë¡œ ë“¤ë©´ ì˜ˆë§¤ ì„œë²„ì— ë™ì‹œì— ë§ì€ í”„ë¡œì„¸ìŠ¤ê°€ ì ‘ê·¼í•˜ë©´ *ë°ì´í„°ë² ì´ìŠ¤*ì— ì„œë¡œ ì ‘ê·¼í•˜ì—¬ *ë©”ëª¨ë¦¬ ìƒ ìë£Œë“¤ì„ ê³µìœ *í•˜ê¸° ë•Œë¬¸ì— ê°ê°ì˜ í”„ë¡œì„¸ìŠ¤ì— ì˜í–¥ì„ ì£¼ê²Œ ë˜ì–´ìˆë‹¤ëŠ” ì´ì•¼ê¸°.
- ë‹¤ë¥¸ ì˜ˆë¡œëŠ” ëŒ€í•™ ì˜¨ë¼ì¸ ìˆ˜ê°•ì‹ ì²­, ì‹¤ì‹œê°„ ì£¼ì‹ê±°ë˜ ë“±ì´ ìˆë‹¤.

*í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬*ì—ì„œ ì¤‘ìš”í•œ ê²ƒì€ *í”„ë¡œì„¸ìŠ¤ ë™ê¸°í™”*ì´ë‹¤.

### BankAccount Problem (ì€í–‰ê³„ì¢Œ ë¬¸ì œ)

ë¶€ëª¨ë‹˜ì´ ì€í–‰ê³„ì¢Œì— ì…ê¸ˆí•˜ê³  ìë…€ê°€ ì¶œê¸ˆì„ í•  ë•Œ, \`ì…ê¸ˆ(deposit)\`ê³¼ \`ì¶œê¸ˆ(withdraw)\`ì€ *ë…ë¦½ì *ìœ¼ë¡œ ì¼ì–´ë‚œë‹¤.

\`\`\`java
class BankAccount {
    int balance;
    
    void deposit(int a) {
        System.out.println("+"); // ì‹œê°„ ì§€ì—°
        int temp = a;
        balance += temp; // ì‹œê°„ ì§€ì—°
    }

    void withdraw(int a) {
        System.out.println("-"); // ì‹œê°„ ì§€ì—°
        int temp = a;
        balance -= temp; // ì‹œê°„ ì§€ì—°
    }

    int getBalance(){
        return balance;
    }
}
class Parent extends Thread {
    BackAccount b;

    Parent(BankAccount b){
        this.b = b;
    }

    public void run(){
        for(int i=0; i<100; i++) {
            b.deposit(1000);
        }
    }
}
class Child extends Thread {
    BackAccount b;

    Child(BankAccount b){
        this.b = b;
    }

    public void run(){
        for(int i=0; i<100; i++) {
            b.withdraw(1000);
        }
    }
}
public class Test {
    public static void main(String[] args) throws InterruptedException {
        BankAccount b = new BankAccount();
        Parent p = new Parent(b);
        Child c = new Child(b);

        p.start();
        c.start();
        p.join(); // ë¶€ëª¨ê°€ ì…ê¸ˆ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
        c.join(); // ìì‹ì´ ì¶œê¸ˆ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
        System.out.println("Balance is : " + b.getBalance());
    }
}
\`\`\`

ì‹œê°„ì§€ì—°ì— ì˜í•´ ê²°ê³¼ ê°’ì´ ë‹¬ë¼ì§ˆ ìˆ˜ê°€ ìˆë‹¤. í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬ì— ìˆì–´ì„œ ì´ëŸ¬í•œ ë¬¸ì œëŠ” ì¤‘ìš”í•˜ë‹¤. ìœ„ì˜ ì½”ë“œëŠ” ì‹œê°„ì§€ì—° ì½”ë“œê°€ ì—†ì–´ë„ ì‹œê°„ì§€ì—°ì€ ìˆê¸° ë§ˆë ¨ì´ë‹¤.

javaê°€ ì»´íŒŒì¼í•  ë•Œ ì–´ì…ˆë¸”ë¦¬ì–´ë¡œ ë³€í™˜ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´ \`balance = balance + amount;\`ê°€ ë³€í™˜ë˜ì–´ í•˜ë‚˜í•˜ë‚˜ì˜ ì½”ë“œê°€ ì—¬ëŸ¬ ì¤„ì´ ëœë‹¤. javaë¡œ ë³¼ ë•ŒëŠ” í•´ë‹¹ ì½”ë“œì—ì„œ ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ì´ ì¼ì–´ë‚˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì´ì§€ë§Œ, ë¡œìš°ë ˆë²¨ ì–¸ì–´ë¡œ ë³€í™˜ë˜ì–´ ì‹¤í–‰ë  ë•ŒëŠ” ì—¬ëŸ¬ ì½”ë“œ ì‚¬ì´ì‚¬ì´ì— ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ì´ ì–¸ì œë¼ë„ ì¼ì–´ë‚  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì¤‘ê°„ì— ìŠ¤ìœ„ì¹­ì´ ì¼ì–´ë‚˜ë©´ ì´ìƒí•œ ê²°ê³¼ê°€ ë‚˜ì˜¬ ìˆ˜ ìˆë‹¤.

#### ì…ì¶œê¸ˆ ë™ì‘ì— ì‹œê°„ ì§€ì—° ì¶”ê°€

ì˜ëª»ëœ ê²°ê³¼ ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. ì´ìœ ëŠ” *ê³µí†µë³€ìˆ˜(common variable)*ì— ëŒ€í•œ *ë™ì‹œ ì—…ë°ì´íŠ¸(concurrent update)*ì— ìˆë‹¤. ì¦‰, \`balance\`ë¼ëŠ” ë³€ìˆ˜ì— ë¶€ëª¨ëŠ” \`deposit\`í•˜ê³  ìì‹ì€ \`withdraw\`í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì„œë¡œ ë‹¤ë¥¸ ì—°ì‚°ì„ í•˜ë©´ì„œ *ë™ì‹œ ì—…ë°ì´íŠ¸*ë˜ì–´ ë¬¸ì œê°€ ë°œìƒí•œë‹¤.

í•´ê²°ë°©ë²•ì€ í•œ ë²ˆì— í•œ ìŠ¤ë ˆë“œë§Œ ì—…ë°ì´íŠ¸ í•˜ë„ë¡ ë°”ê¿”ì•¼ í•œë‹¤. ì¦‰, ë„ì¤‘ì— ìŠ¤ìœ„ì¹­ì´ ì¼ì–´ë‚˜ê²Œ í•´ì„œëŠ” ì•ˆ ëœë‹¤ëŠ” ê²ƒì´ë‹¤. ì´ë¥¼ *ì„ê³„êµ¬ì—­ ë¬¸ì œ*ë¼ í•œë‹¤.
`],
    ref: [
        {
            name: 'ê²½ì„±ëŒ€ ì–‘í¬ì¬ êµìˆ˜ë‹˜ - 4ê°• í”„ë¡œì„¸ìŠ¤ ë™ê¸°í™”',
            link: 'http://www.kocw.net/home/cview.do?mty=p&kemId=978503',
        },
    ],
    template(){
        this.title = this.origin.name;
        return `
        ${wikiFilter.all.call(this)}
        `
    }
}